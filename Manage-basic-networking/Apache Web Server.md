# Configuring Apache Web Server
1. Install using `sudo dnf group install "Basic Web Server`
2. Enable the service using `sudo systemctl enable --now httpd`
3. Add service and ports to the firewall
    * `sudo firewall-cmd --permanent --zone=public --add-port=80/tcp`
    * `sudo firewall-cmd --permanent --zone=public --add-port=443/tcp`
    * `sudo firewall-cmd --permanent --zone=public --add-service=http`
    * `sudo firewall-cmd --permanent --zone=public --add-service=https`
    * `sudo firewall-cmd --reload && sudo systemctl restart firewalld`
    * Verify with `sudo firewall-cmd --list-all`
4. Enable the ports used through SELinux
    * `sudo semanage port -a -t http_port_t -p tcp <port>`
    * To view enabled http ports use `sudo semanage port -l | grep http`
5. Main configuration file can be found in the `/etc/httpd/config/httpd.conf` file
6. Add a basic `index.html` file at `/var/www/html` to setup a default landing page.
    ```html
    <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Sample Nginx Landing Page</title>
        </head>
        <body>
            <h1>Hello World!</h1>
        </body>
    </html>
    ```

## Configuring Apache Web Server as a docker container
*You will have to follow the same networking steps as listed in the previous approach regarding firewall and SELinux configuration*
1. `sudo dnf install docker`
    * Will install `podman-docker` (not the actual docker)
2. `sudo docker pull docker.io/libary/nginx:latest`
3. On a very basic level, it can be run like this
    ```bash
    docker run --name nginx \
        -p 80:80 \
        nginx:latest
    ```
### Adding a landing page to the container
1. Create a folder containing a basic `index.html` file (like the one above).
2. Add the folder as a docker volume
    ```bash
    docker run --name nginx \
        -p 80:80 \
        -v /var/www/html:/usr/share/nginx/html \
        nginx:latest
    ``` 

### Configuring the container to start up as a systemd service
#### Option 1: Create systemd service somewhat by hand
1. Convert the commands starting and stopping the services into 2 bash scripts.
2. Create a simple systemd service file
    ```ini
    # nginx.service
    [Unit]
    Description=Nginx-as-service
    After=local-fs.target network.target

    [Service]
    ExecStart=<absolute path to bash start script>
    ExecStop=<absolute path to bash stop script>
    Restart=unless-stopped

    [Install]
    WantedBy=default.target multi-user.target
    ```
3. `sudo systemctl enable --now nginx.service`
4. `sudo systemctl start nginx.service`

## Auto-generating a systemd service using Quadlet
**Note:** I could not figure out how to get this to run as root. Documentation indicates the only change is running `sudo systemctl daemon-reload`, but it did not work. Technically you could use `podman-generate`, but there are a lot of deprecation errors associated with it, and it seems safer to use the "recommended" approach even if its more work.

1. `cd /etc/containers/systemd/users/`
2. `sudo vim nginx.container`
    ```ini
    # nginx.service
    [Unit]
    Description=Nginx-as-service
    After=local-fs.target network.target

    [Container]
    ContainerName=nginx
    Image=docker.io/libary/nginx
    PublishPort=8080:80   # Make sure to use a higher port or this won't work
    Volume=<local directory with index.html>:/usr/share/nginx/html

    [Install]
    WantedBy=default.target multi-user.target
    ```
3. Verify the file is correct
    * `/usr/libexec/podman/quadlet -dryrun -user`, if its correct, it should spit out an autogenerated service file
    * `journalctl` to see if anything failed
4. `systemctl --user daemon-reload`
5. `systemctl --user start nginx.service`

















